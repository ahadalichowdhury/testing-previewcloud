services:
  frontend:
    dockerfile: ./frontend/Dockerfile
    env:
      - API_URL: ${API_URL} # Auto-injected by PreviewCloud
      - NODE_ENV: production
    port: 80
    root: true  # ← Add this! Makes frontend use: pr-{pr_number}-{owner}.previewcloud.com

  api:
    dockerfile: ./backend/Dockerfile
    port: 5000
    path: /api  # ← Add this! Makes backend use: pr-{pr_number}-{owner}.previewcloud.com/api
    env:
      - DATABASE_URL=${DATABASE_URL}
      - API_KEY=${API_KEY}

database:
  type: postgres
  migrations: ./migrations